javascript:(function(){const CONSENSUS_CHANNEL_ID='1376328338641129602';let monitoring=false;let monitorInterval=null;let processedMessageIds=new Set();let pendingMessages=[];function getCurrentChannelId(){const url=window.location.href;const match=url.match(/\/channels\/\d+\/(\d+)/);return match?match[1]:null;}function writeBatchedMessages(messages){const outputContent=messages.map(msg=>`${msg.author}\n${msg.content}\n${msg.discordTimestamp}`).join('\n');const blob=new Blob([outputContent],{type:'text/plain'});const url=URL.createObjectURL(blob);const link=document.createElement('a');link.href=url;link.download='output.txt';link.style.display='none';document.body.appendChild(link);link.click();document.body.removeChild(link);URL.revokeObjectURL(url);}function collectNewMessages(){const messageContainer=document.querySelector('[data-list-id="chat-messages"]')||document.querySelector('[class*="messagesWrapper"]')||document.querySelector('[class*="scroller"][class*="messages"]');if(!messageContainer){console.log('%E2%9A%A0%EF%B8%8F Could not find message container');return;}const messages=messageContainer.querySelectorAll('[id^="chat-messages-"], [class*="message-"][class*="cozy"], div[class*="message"]:not([class*="wrapper"]):not([class*="divider"])');messages.forEach(msg=>{try{if(processedMessageIds.has(msg.id||msg.innerHTML))return;const authorElement=msg.querySelector('[class*="username"]:not([class*="bot"]), [class*="headerText"] [class*="username"]');const contentElement=msg.querySelector('[class*="messageContent"]:not([class*="repliedTextContent"]), [data-slate-editor="true"], [class*="markup"]');if(authorElement&&contentElement){const author=authorElement.textContent.trim();const content=contentElement.textContent.trim();const timestampElement=msg.querySelector('time[datetime]');let discordTimestamp;if(timestampElement&&timestampElement.getAttribute('datetime')){discordTimestamp=Math.floor(new Date(timestampElement.getAttribute('datetime')).getTime()/1000);}else{discordTimestamp=Math.floor(Date.now()/1000);console.log('%E2%9A%A0%EF%B8%8F Using fallback timestamp for message from',author);}if(!content||content.length===0||content.includes('Use the up and down arrow keys')||content.includes('New messages will be added')||author.length===0||/^(Today|Yesterday|\w+day|\w+ \d+, \d+)$/.test(content)||content.startsWith('!')||author.includes('ConsensusBot')){return;}const messageId=msg.id||`${author}-${content.substring(0,50)}-${discordTimestamp}`;if(!processedMessageIds.has(messageId)){processedMessageIds.add(messageId);pendingMessages.push({author:author,content:content,discordTimestamp:discordTimestamp,localTimestamp:Date.now()});const discordTime=new Date(discordTimestamp*1000).toLocaleTimeString();console.log(`%E2%9C%85 Queued message from ${author} (Discord: ${discordTime}): ${content.substring(0,50)}...`);}}}catch(error){console.log('Error processing message:',error);}});}function monitoringCycle(){const currentChannelId=getCurrentChannelId();if(currentChannelId!==CONSENSUS_CHANNEL_ID){return;}pendingMessages=[];collectNewMessages();if(pendingMessages.length>0){console.log(`%F0%9F%93%9D Writing ${pendingMessages.length} new messages to file`);writeBatchedMessages(pendingMessages);updateDisplay();}}function startMonitoring(){if(monitoring)return;const currentChannelId=getCurrentChannelId();if(currentChannelId!==CONSENSUS_CHANNEL_ID){alert('Please navigate to the Consensus Channel first!');return;}processedMessageIds.clear();pendingMessages=[];const messageContainer=document.querySelector('[data-list-id="chat-messages"]')||document.querySelector('[class*="messagesWrapper"]')||document.querySelector('[class*="scroller"][class*="messages"]');if(messageContainer){const existingMessages=messageContainer.querySelectorAll('[id^="chat-messages-"], [class*="message-"][class*="cozy"], div[class*="message"]:not([class*="wrapper"]):not([class*="divider"])');existingMessages.forEach(msg=>{try{const authorElement=msg.querySelector('[class*="username"]:not([class*="bot"]), [class*="headerText"] [class*="username"]');const contentElement=msg.querySelector('[class*="messageContent"]:not([class*="repliedTextContent"]), [data-slate-editor="true"], [class*="markup"]');if(authorElement&&contentElement){const author=authorElement.textContent.trim();const content=contentElement.textContent.trim();const timestampElement=msg.querySelector('time[datetime]');const discordTimestamp=timestampElement?Math.floor(new Date(timestampElement.getAttribute('datetime')).getTime()/1000):Math.floor(Date.now()/1000);const messageId=msg.id||`${author}-${content.substring(0,50)}-${discordTimestamp}`;processedMessageIds.add(messageId);}}catch(error){}});}monitoring=true;console.log('%F0%9F%94%84 Starting Consensus Channel monitoring...');console.log(`%F0%9F%93%8B Ignoring ${processedMessageIds.size} existing messages`);console.log('%E2%8F%B0 Checking for new messages every 3 seconds');console.log('%F0%9F%8C%90 DOM-only monitoring - no API calls to Discord');console.log('%E2%9D%97 Filtering out messages that start with "!" and from ConsensusBot authors');monitorInterval=setInterval(monitoringCycle,3000);updateDisplay();}function stopMonitoring(){if(!monitoring)return;monitoring=false;if(monitorInterval){clearInterval(monitorInterval);monitorInterval=null;}pendingMessages=[];console.log('%E2%8F%B8%EF%B8%8F Monitoring stopped');updateDisplay();}function clearData(){processedMessageIds.clear();pendingMessages=[];console.log('%F0%9F%97%91%EF%B8%8F Processed messages cleared');updateDisplay();}function updateDisplay(){const existing=document.getElementById('consensus-monitor-panel');if(existing)existing.remove();const panel=document.createElement('div');panel.id='consensus-monitor-panel';panel.style.cssText=`position: fixed;top: 10px;right: 10px;background: #2f3136;color:%20#dcddde;padding:%2015px;border-radius:%208px;box-shadow:%200%204px%2012px%20rgba(0,0,0,0.3);z-index:%209999;font-family:%20Arial,%20sans-serif;font-size:%2014px;min-width:%20280px;border:%201px%20solid%20#484b51;`;const%20statusColor=monitoring?'#43b581':'#f04747';const%20statusText=monitoring?'MONITORING':'STOPPED';const%20currentChannelId=getCurrentChannelId();const%20onTargetChannel=currentChannelId===CONSENSUS_CHANNEL_ID;panel.innerHTML=`<div%20style='font-weight:%20bold;%20margin-bottom:%2015px;%20display:%20flex;%20align-items:%20center;'><span>%F0%9F%93%A6%20New%20Block%20Monitor</span><span%20style='margin-left:%20auto;%20font-size:%2010px;%20color:%20${statusColor};%20background:%20${statusColor}20;%20padding:%202px%206px;%20border-radius:%203px;'>${statusText}</span></div><div%20style='margin-bottom:%2010px;%20font-size:%2012px;%20color:%20${onTargetChannel?'#43b581':'#f04747'};'><strong>Channel:</strong>%20${onTargetChannel?'Consensus%20Channel%20%E2%9C%93':'Not%20on%20Consensus%20Channel'}</div><div%20style='margin-bottom:%2015px;%20background:%20#40444b;%20padding:%2010px;%20border-radius:%204px;'><div%20style='font-size:%2012px;'><strong>Processed:</strong>%20${processedMessageIds.size}</div><div%20style='font-size:%2012px;'><strong>Pending:</strong>%20${pendingMessages.length}</div></div><div%20style='display:%20grid;%20grid-template-columns:%201fr%201fr;%20gap:%208px;%20margin-bottom:%2010px;'><button%20id='consensus-start-btn'%20style='background:%20#43b581;%20color:%20white;%20border:%20none;%20padding:%208px;%20border-radius:%204px;%20cursor:%20pointer;%20font-size:%2012px;'>%E2%96%B6%EF%B8%8F%20Start</button><button%20id='consensus-stop-btn'%20style='background:%20#f04747;%20color:%20white;%20border:%20none;%20padding:%208px;%20border-radius:%204px;%20cursor:%20pointer;%20font-size:%2012px;'>%E2%8F%B8%EF%B8%8F%20Stop</button><button%20id='consensus-clear-btn'%20style='background:%20#72767d;%20color:%20white;%20border:%20none;%20padding:%208px;%20border-radius:%204px;%20cursor:%20pointer;%20font-size:%2012px;'>%F0%9F%97%91%EF%B8%8F%20Clear</button><button%20id='consensus-close-btn'%20style='background:%20#72767d;%20color:%20white;%20border:%20none;%20padding:%208px;%20border-radius:%204px;%20cursor:%20pointer;%20font-size:%2012px;'>%E2%9C%96%EF%B8%8F%20Close</button></div><div%20style='font-size:%2011px;%20color:%20#72767d;%20text-align:%20center;'>Batches%20new%20messages%20every%203%20seconds<br><span%20style='color:%20#43b581;'>DOM-only%20%E2%80%A2%20Discord%20timestamps%20included</span><br><span%20style='color:%20#f04747;'>%E2%9D%97%20Excludes%20"!"%20messages%20and%20ConsensusBot%20authors</span></div>`;document.body.appendChild(panel);document.getElementById('consensus-start-btn').onclick=startMonitoring;document.getElementById('consensus-stop-btn').onclick=stopMonitoring;document.getElementById('consensus-clear-btn').onclick=clearData;document.getElementById('consensus-close-btn').onclick=()=>{stopMonitoring();panel.remove();};}console.log('%F0%9F%9A%80%20Consensus%20Channel%20Monitor%20loaded!');console.log('%E2%8F%B0%20Batches%20new%20messages%20every%203%20seconds');console.log('%F0%9F%8C%90%20DOM-only%20monitoring%20-%20no%20network%20calls%20to%20Discord');console.log('%E2%8F%B1%EF%B8%8F%20Captures%20Discord%20native%20timestamps%20for%20synchronization');console.log('%E2%9D%97%20Filtering%20out%20messages%20that%20start%20with%20"!"%20and%20from%20ConsensusBot%20authors');if(!document.getElementById('consensus-monitor-panel')){updateDisplay();startMonitoring();}window.startConsensusMonitoring=startMonitoring;window.stopConsensusMonitoring=stopMonitoring;window.clearConsensusData=clearData;})();